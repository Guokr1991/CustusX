/*=========================================================================
This file is part of CustusX, an Image Guided Therapy Application.

Copyright (c) 2008-2014, SINTEF Department of Medical Technology
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:

1. Redistributions of source code must retain the above copyright notice,
   this list of conditions and the following disclaimer.

2. Redistributions in binary form must reproduce the above copyright notice,
   this list of conditions and the following disclaimer in the documentation
   and/or other materials provided with the distribution.

3. Neither the name of the copyright holder nor the names of its contributors
   may be used to endorse or promote products derived from this software
   without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
=========================================================================*/

#include "cxtestUr5TestFixture.h"

#include <QFile>

namespace cxtest
{

Ur5TestFixture::Ur5TestFixture() :
    mUr5Robot(),
    mUr5Connection()
{
}

QByteArray Ur5TestFixture::getTestData(int packetSize)
{
    if(packetSize == 560)
    {
        QString filename = "C:/Dev/cx/Cx/CX/source/plugins/org.custusx.robot.ur5/testing/test.data/cxDataFromRobot560.txt";
        QFile file(filename);
        if (!file.open(QIODevice::ReadOnly)) return QByteArray();
        return QByteArray::fromHex(file.readAll());
    }
    else if(packetSize == 1254)
    {
        QString filename = "C:/Dev/cx/Cx/CX/source/plugins/org.custusx.robot.ur5/testing/test.data/cxDataFromRobot1254.txt";
        QFile file(filename);
        if (!file.open(QIODevice::ReadOnly)) return QByteArray();
        return QByteArray::fromHex(file.readAll());
    }
    else if(packetSize == 1460)
    {
        QString filename = "C:/Dev/cx/Cx/CX/source/plugins/org.custusx.robot.ur5/testing/test.data/cxDataFromRobot1460.txt";
        QFile file(filename);
        if (!file.open(QIODevice::ReadOnly)) return QByteArray();
        return QByteArray::fromHex(file.readAll());
    }
    else
    {
        return QByteArray(0);
    }
}

Eigen::MatrixXd Ur5TestFixture::jacobianUr5(Eigen::RowVectorXd jointPositions)
{
    double th1 = jointPositions(0);
    double th2 = jointPositions(1);
    double th3 = jointPositions(2);
    double th4 = jointPositions(3);
    double th5 = jointPositions(4);
    double th6 = jointPositions(5);

    Eigen::MatrixXd matrix(6,6);

    matrix << (2183*cos(th1))/20000 + (823*cos(th1)*cos(th5))/10000 + (17*cos(th2)*sin(th1))/40 - (1893*cos(th4)*(cos(th2)*sin(th1)*sin(th3) + cos(th3)*sin(th1)*sin(th2)))/20000 + (1893*sin(th4)*(sin(th1)*sin(th2)*sin(th3) - cos(th2)*cos(th3)*sin(th1)))/20000 - (823*sin(th5)*(cos(th4)*(sin(th1)*sin(th2)*sin(th3) - cos(th2)*cos(th3)*sin(th1)) + sin(th4)*(cos(th2)*sin(th1)*sin(th3) + cos(th3)*sin(th1)*sin(th2))))/10000 - (157*sin(th1)*sin(th2)*sin(th3))/400 + (157*cos(th2)*cos(th3)*sin(th1))/400,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              cos(th1)*((17*sin(th2))/40 + (157*cos(th2)*sin(th3))/400 + (157*cos(th3)*sin(th2))/400 + (823*sin(th5)*(cos(th4)*(cos(th2)*sin(th3) + cos(th3)*sin(th2)) + sin(th4)*(cos(th2)*cos(th3) - sin(th2)*sin(th3))))/10000 + (1893*cos(th4)*(cos(th2)*cos(th3) - sin(th2)*sin(th3)))/20000 - (1893*sin(th4)*(cos(th2)*sin(th3) + cos(th3)*sin(th2)))/20000),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         cos(th1)*((157*cos(th2)*sin(th3))/400 + (157*cos(th3)*sin(th2))/400 + (823*sin(th5)*(cos(th4)*(cos(th2)*sin(th3) + cos(th3)*sin(th2)) + sin(th4)*(cos(th2)*cos(th3) - sin(th2)*sin(th3))))/10000 + (1893*cos(th4)*(cos(th2)*cos(th3) - sin(th2)*sin(th3)))/20000 - (1893*sin(th4)*(cos(th2)*sin(th3) + cos(th3)*sin(th2)))/20000),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         cos(th1)*((823*sin(th5)*(cos(th4)*(cos(th2)*sin(th3) + cos(th3)*sin(th2)) + sin(th4)*(cos(th2)*cos(th3) - sin(th2)*sin(th3))))/10000 + (1893*cos(th4)*(cos(th2)*cos(th3) - sin(th2)*sin(th3)))/20000 - (1893*sin(th4)*(cos(th2)*sin(th3) + cos(th3)*sin(th2)))/20000),                                                                                                                                             - (cos(th4)*(cos(th2)*cos(th3) - sin(th2)*sin(th3)) - sin(th4)*(cos(th2)*sin(th3) + cos(th3)*sin(th2)))*((823*cos(th1)*cos(th5))/10000 - (1893*cos(th4)*(cos(th2)*sin(th1)*sin(th3) + cos(th3)*sin(th1)*sin(th2)))/20000 + (1893*sin(th4)*(sin(th1)*sin(th2)*sin(th3) - cos(th2)*cos(th3)*sin(th1)))/20000 - (823*sin(th5)*(cos(th4)*(sin(th1)*sin(th2)*sin(th3) - cos(th2)*cos(th3)*sin(th1)) + sin(th4)*(cos(th2)*sin(th1)*sin(th3) + cos(th3)*sin(th1)*sin(th2))))/10000) - (cos(th4)*(cos(th2)*sin(th1)*sin(th3) + cos(th3)*sin(th1)*sin(th2)) - sin(th4)*(sin(th1)*sin(th2)*sin(th3) - cos(th2)*cos(th3)*sin(th1)))*((823*sin(th5)*(cos(th4)*(cos(th2)*sin(th3) + cos(th3)*sin(th2)) + sin(th4)*(cos(th2)*cos(th3) - sin(th2)*sin(th3))))/10000 + (1893*cos(th4)*(cos(th2)*cos(th3) - sin(th2)*sin(th3)))/20000 - (1893*sin(th4)*(cos(th2)*sin(th3) + cos(th3)*sin(th2)))/20000),                                                                                                                                 (823*sin(th5)*(cos(th4)*(cos(th2)*sin(th3) + cos(th3)*sin(th2)) + sin(th4)*(cos(th2)*cos(th3) - sin(th2)*sin(th3)))*(cos(th1)*cos(th5) - sin(th5)*(cos(th4)*(sin(th1)*sin(th2)*sin(th3) - cos(th2)*cos(th3)*sin(th1)) + sin(th4)*(cos(th2)*sin(th1)*sin(th3) + cos(th3)*sin(th1)*sin(th2)))))/10000 - sin(th5)*(cos(th4)*(cos(th2)*sin(th3) + cos(th3)*sin(th2)) + sin(th4)*(cos(th2)*cos(th3) - sin(th2)*sin(th3)))*((823*cos(th1)*cos(th5))/10000 - (823*sin(th5)*(cos(th4)*(sin(th1)*sin(th2)*sin(th3) - cos(th2)*cos(th3)*sin(th1)) + sin(th4)*(cos(th2)*sin(th1)*sin(th3) + cos(th3)*sin(th1)*sin(th2))))/10000),
              (2183*sin(th1))/20000 - (17*cos(th1)*cos(th2))/40 + (823*cos(th5)*sin(th1))/10000 + (1893*cos(th4)*(cos(th1)*cos(th2)*sin(th3) + cos(th1)*cos(th3)*sin(th2)))/20000 - (1893*sin(th4)*(cos(th1)*sin(th2)*sin(th3) - cos(th1)*cos(th2)*cos(th3)))/20000 + (823*sin(th5)*(cos(th4)*(cos(th1)*sin(th2)*sin(th3) - cos(th1)*cos(th2)*cos(th3)) + sin(th4)*(cos(th1)*cos(th2)*sin(th3) + cos(th1)*cos(th3)*sin(th2))))/10000 + (157*cos(th1)*sin(th2)*sin(th3))/400 - (157*cos(th1)*cos(th2)*cos(th3))/400,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              sin(th1)*((17*sin(th2))/40 + (157*cos(th2)*sin(th3))/400 + (157*cos(th3)*sin(th2))/400 + (823*sin(th5)*(cos(th4)*(cos(th2)*sin(th3) + cos(th3)*sin(th2)) + sin(th4)*(cos(th2)*cos(th3) - sin(th2)*sin(th3))))/10000 + (1893*cos(th4)*(cos(th2)*cos(th3) - sin(th2)*sin(th3)))/20000 - (1893*sin(th4)*(cos(th2)*sin(th3) + cos(th3)*sin(th2)))/20000),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         sin(th1)*((157*cos(th2)*sin(th3))/400 + (157*cos(th3)*sin(th2))/400 + (823*sin(th5)*(cos(th4)*(cos(th2)*sin(th3) + cos(th3)*sin(th2)) + sin(th4)*(cos(th2)*cos(th3) - sin(th2)*sin(th3))))/10000 + (1893*cos(th4)*(cos(th2)*cos(th3) - sin(th2)*sin(th3)))/20000 - (1893*sin(th4)*(cos(th2)*sin(th3) + cos(th3)*sin(th2)))/20000),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         sin(th1)*((823*sin(th5)*(cos(th4)*(cos(th2)*sin(th3) + cos(th3)*sin(th2)) + sin(th4)*(cos(th2)*cos(th3) - sin(th2)*sin(th3))))/10000 + (1893*cos(th4)*(cos(th2)*cos(th3) - sin(th2)*sin(th3)))/20000 - (1893*sin(th4)*(cos(th2)*sin(th3) + cos(th3)*sin(th2)))/20000),                                                                                                                                               (cos(th4)*(cos(th1)*cos(th2)*sin(th3) + cos(th1)*cos(th3)*sin(th2)) - sin(th4)*(cos(th1)*sin(th2)*sin(th3) - cos(th1)*cos(th2)*cos(th3)))*((823*sin(th5)*(cos(th4)*(cos(th2)*sin(th3) + cos(th3)*sin(th2)) + sin(th4)*(cos(th2)*cos(th3) - sin(th2)*sin(th3))))/10000 + (1893*cos(th4)*(cos(th2)*cos(th3) - sin(th2)*sin(th3)))/20000 - (1893*sin(th4)*(cos(th2)*sin(th3) + cos(th3)*sin(th2)))/20000) - (cos(th4)*(cos(th2)*cos(th3) - sin(th2)*sin(th3)) - sin(th4)*(cos(th2)*sin(th3) + cos(th3)*sin(th2)))*((823*cos(th5)*sin(th1))/10000 + (1893*cos(th4)*(cos(th1)*cos(th2)*sin(th3) + cos(th1)*cos(th3)*sin(th2)))/20000 - (1893*sin(th4)*(cos(th1)*sin(th2)*sin(th3) - cos(th1)*cos(th2)*cos(th3)))/20000 + (823*sin(th5)*(cos(th4)*(cos(th1)*sin(th2)*sin(th3) - cos(th1)*cos(th2)*cos(th3)) + sin(th4)*(cos(th1)*cos(th2)*sin(th3) + cos(th1)*cos(th3)*sin(th2))))/10000),                                                                                                                                 (823*sin(th5)*(cos(th4)*(cos(th2)*sin(th3) + cos(th3)*sin(th2)) + sin(th4)*(cos(th2)*cos(th3) - sin(th2)*sin(th3)))*(cos(th5)*sin(th1) + sin(th5)*(cos(th4)*(cos(th1)*sin(th2)*sin(th3) - cos(th1)*cos(th2)*cos(th3)) + sin(th4)*(cos(th1)*cos(th2)*sin(th3) + cos(th1)*cos(th3)*sin(th2)))))/10000 - sin(th5)*(cos(th4)*(cos(th2)*sin(th3) + cos(th3)*sin(th2)) + sin(th4)*(cos(th2)*cos(th3) - sin(th2)*sin(th3)))*((823*cos(th5)*sin(th1))/10000 + (823*sin(th5)*(cos(th4)*(cos(th1)*sin(th2)*sin(th3) - cos(th1)*cos(th2)*cos(th3)) + sin(th4)*(cos(th1)*cos(th2)*sin(th3) + cos(th1)*cos(th3)*sin(th2))))/10000),
               0, cos(th1)*((2183*sin(th1))/20000 - (17*cos(th1)*cos(th2))/40 + (823*cos(th5)*sin(th1))/10000 + (1893*cos(th4)*(cos(th1)*cos(th2)*sin(th3) + cos(th1)*cos(th3)*sin(th2)))/20000 - (1893*sin(th4)*(cos(th1)*sin(th2)*sin(th3) - cos(th1)*cos(th2)*cos(th3)))/20000 + (823*sin(th5)*(cos(th4)*(cos(th1)*sin(th2)*sin(th3) - cos(th1)*cos(th2)*cos(th3)) + sin(th4)*(cos(th1)*cos(th2)*sin(th3) + cos(th1)*cos(th3)*sin(th2))))/10000 + (157*cos(th1)*sin(th2)*sin(th3))/400 - (157*cos(th1)*cos(th2)*cos(th3))/400) - sin(th1)*((2183*cos(th1))/20000 + (823*cos(th1)*cos(th5))/10000 + (17*cos(th2)*sin(th1))/40 - (1893*cos(th4)*(cos(th2)*sin(th1)*sin(th3) + cos(th3)*sin(th1)*sin(th2)))/20000 + (1893*sin(th4)*(sin(th1)*sin(th2)*sin(th3) - cos(th2)*cos(th3)*sin(th1)))/20000 - (823*sin(th5)*(cos(th4)*(sin(th1)*sin(th2)*sin(th3) - cos(th2)*cos(th3)*sin(th1)) + sin(th4)*(cos(th2)*sin(th1)*sin(th3) + cos(th3)*sin(th1)*sin(th2))))/10000 - (157*sin(th1)*sin(th2)*sin(th3))/400 + (157*cos(th2)*cos(th3)*sin(th1))/400), cos(th1)*((2183*sin(th1))/20000 + (823*cos(th5)*sin(th1))/10000 + (1893*cos(th4)*(cos(th1)*cos(th2)*sin(th3) + cos(th1)*cos(th3)*sin(th2)))/20000 - (1893*sin(th4)*(cos(th1)*sin(th2)*sin(th3) - cos(th1)*cos(th2)*cos(th3)))/20000 + (823*sin(th5)*(cos(th4)*(cos(th1)*sin(th2)*sin(th3) - cos(th1)*cos(th2)*cos(th3)) + sin(th4)*(cos(th1)*cos(th2)*sin(th3) + cos(th1)*cos(th3)*sin(th2))))/10000 + (157*cos(th1)*sin(th2)*sin(th3))/400 - (157*cos(th1)*cos(th2)*cos(th3))/400) - sin(th1)*((2183*cos(th1))/20000 + (823*cos(th1)*cos(th5))/10000 - (1893*cos(th4)*(cos(th2)*sin(th1)*sin(th3) + cos(th3)*sin(th1)*sin(th2)))/20000 + (1893*sin(th4)*(sin(th1)*sin(th2)*sin(th3) - cos(th2)*cos(th3)*sin(th1)))/20000 - (823*sin(th5)*(cos(th4)*(sin(th1)*sin(th2)*sin(th3) - cos(th2)*cos(th3)*sin(th1)) + sin(th4)*(cos(th2)*sin(th1)*sin(th3) + cos(th3)*sin(th1)*sin(th2))))/10000 - (157*sin(th1)*sin(th2)*sin(th3))/400 + (157*cos(th2)*cos(th3)*sin(th1))/400), cos(th1)*((2183*sin(th1))/20000 + (823*cos(th5)*sin(th1))/10000 + (1893*cos(th4)*(cos(th1)*cos(th2)*sin(th3) + cos(th1)*cos(th3)*sin(th2)))/20000 - (1893*sin(th4)*(cos(th1)*sin(th2)*sin(th3) - cos(th1)*cos(th2)*cos(th3)))/20000 + (823*sin(th5)*(cos(th4)*(cos(th1)*sin(th2)*sin(th3) - cos(th1)*cos(th2)*cos(th3)) + sin(th4)*(cos(th1)*cos(th2)*sin(th3) + cos(th1)*cos(th3)*sin(th2))))/10000) - sin(th1)*((2183*cos(th1))/20000 + (823*cos(th1)*cos(th5))/10000 - (1893*cos(th4)*(cos(th2)*sin(th1)*sin(th3) + cos(th3)*sin(th1)*sin(th2)))/20000 + (1893*sin(th4)*(sin(th1)*sin(th2)*sin(th3) - cos(th2)*cos(th3)*sin(th1)))/20000 - (823*sin(th5)*(cos(th4)*(sin(th1)*sin(th2)*sin(th3) - cos(th2)*cos(th3)*sin(th1)) + sin(th4)*(cos(th2)*sin(th1)*sin(th3) + cos(th3)*sin(th1)*sin(th2))))/10000), - (cos(th4)*(cos(th2)*sin(th1)*sin(th3) + cos(th3)*sin(th1)*sin(th2)) - sin(th4)*(sin(th1)*sin(th2)*sin(th3) - cos(th2)*cos(th3)*sin(th1)))*((823*cos(th5)*sin(th1))/10000 + (1893*cos(th4)*(cos(th1)*cos(th2)*sin(th3) + cos(th1)*cos(th3)*sin(th2)))/20000 - (1893*sin(th4)*(cos(th1)*sin(th2)*sin(th3) - cos(th1)*cos(th2)*cos(th3)))/20000 + (823*sin(th5)*(cos(th4)*(cos(th1)*sin(th2)*sin(th3) - cos(th1)*cos(th2)*cos(th3)) + sin(th4)*(cos(th1)*cos(th2)*sin(th3) + cos(th1)*cos(th3)*sin(th2))))/10000) - (cos(th4)*(cos(th1)*cos(th2)*sin(th3) + cos(th1)*cos(th3)*sin(th2)) - sin(th4)*(cos(th1)*sin(th2)*sin(th3) - cos(th1)*cos(th2)*cos(th3)))*((823*cos(th1)*cos(th5))/10000 - (1893*cos(th4)*(cos(th2)*sin(th1)*sin(th3) + cos(th3)*sin(th1)*sin(th2)))/20000 + (1893*sin(th4)*(sin(th1)*sin(th2)*sin(th3) - cos(th2)*cos(th3)*sin(th1)))/20000 - (823*sin(th5)*(cos(th4)*(sin(th1)*sin(th2)*sin(th3) - cos(th2)*cos(th3)*sin(th1)) + sin(th4)*(cos(th2)*sin(th1)*sin(th3) + cos(th3)*sin(th1)*sin(th2))))/10000), ((823*cos(th5)*sin(th1))/10000 + (823*sin(th5)*(cos(th4)*(cos(th1)*sin(th2)*sin(th3) - cos(th1)*cos(th2)*cos(th3)) + sin(th4)*(cos(th1)*cos(th2)*sin(th3) + cos(th1)*cos(th3)*sin(th2))))/10000)*(cos(th1)*cos(th5) - sin(th5)*(cos(th4)*(sin(th1)*sin(th2)*sin(th3) - cos(th2)*cos(th3)*sin(th1)) + sin(th4)*(cos(th2)*sin(th1)*sin(th3) + cos(th3)*sin(th1)*sin(th2)))) - (cos(th5)*sin(th1) + sin(th5)*(cos(th4)*(cos(th1)*sin(th2)*sin(th3) - cos(th1)*cos(th2)*cos(th3)) + sin(th4)*(cos(th1)*cos(th2)*sin(th3) + cos(th1)*cos(th3)*sin(th2))))*((823*cos(th1)*cos(th5))/10000 - (823*sin(th5)*(cos(th4)*(sin(th1)*sin(th2)*sin(th3) - cos(th2)*cos(th3)*sin(th1)) + sin(th4)*(cos(th2)*sin(th1)*sin(th3) + cos(th3)*sin(th1)*sin(th2))))/10000),
               0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          sin(th1),                                                                                                                                                                                                                                                                                                                                                                                                                                                                           sin(th1),sin(th1),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           cos(th4)*(cos(th1)*cos(th2)*sin(th3) + cos(th1)*cos(th3)*sin(th2)) - sin(th4)*(cos(th1)*sin(th2)*sin(th3) - cos(th1)*cos(th2)*cos(th3)),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cos(th5)*sin(th1) + sin(th5)*(cos(th4)*(cos(th1)*sin(th2)*sin(th3) - cos(th1)*cos(th2)*cos(th3)) + sin(th4)*(cos(th1)*cos(th2)*sin(th3) + cos(th1)*cos(th3)*sin(th2))),
                                                                                                                                                                                                                                                                                                        0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         -cos(th1),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 -cos(th1),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     -cos(th1),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           cos(th4)*(cos(th2)*sin(th1)*sin(th3) + cos(th3)*sin(th1)*sin(th2)) - sin(th4)*(sin(th1)*sin(th2)*sin(th3) - cos(th2)*cos(th3)*sin(th1)),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                sin(th5)*(cos(th4)*(sin(th1)*sin(th2)*sin(th3) - cos(th2)*cos(th3)*sin(th1)) + sin(th4)*(cos(th2)*sin(th1)*sin(th3) + cos(th3)*sin(th1)*sin(th2))) - cos(th1)*cos(th5),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    1,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               sin(th4)*(cos(th2)*sin(th3) + cos(th3)*sin(th2)) - cos(th4)*(cos(th2)*cos(th3) - sin(th2)*sin(th3)),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       -sin(th5)*(cos(th4)*(cos(th2)*sin(th3) + cos(th3)*sin(th2)) + sin(th4)*(cos(th2)*cos(th3) - sin(th2)*sin(th3)));

    return matrix;
}

} //cxtest
